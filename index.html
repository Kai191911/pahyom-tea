<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡∏ä‡∏≤‡∏û‡∏∞‡∏¢‡∏≠‡∏° </title>

  <style>
    /* ========== Theme & base ========= */
    :root{
      --green-dark: #2f6b34;
      --green-mid: #4fb64f;
      --green-soft: #e9f6ea;
      --cream: #f6fbf6;
      --accent: #84ff9f;
      --text: #213826;
      --card-shadow: 0 8px 24px rgba(47,107,52,0.12);
      --glass: rgba(255,255,255,0.85);
    }

    html,body{height:100%;margin:0;font-family: "Prompt", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:var(--text); background:linear-gradient(180deg,#f2fbf3 0%,#e8f6ea 100%); -webkit-font-smoothing:antialiased;}

    /* ========== Header (like kiosk top) ========= */
    header{
      position:sticky; top:0; z-index:50;
      background: linear-gradient(90deg,var(--green-dark),var(--green-mid));
      color:#fff;
      padding:14px 16px;
      display:flex;
      align-items:center;
      gap:12px;
      box-shadow: 0 6px 18px rgba(47,107,52,0.18);
    }
    .logo {
      width:44px;height:44px;border-radius:10px;
      background:linear-gradient(180deg,#fff6e6,#fff0d1);
      display:flex;align-items:center;justify-content:center;color:var(--green-dark);
      font-weight:700; box-shadow: inset 0 -6px 12px rgba(0,0,0,0.04);
    }
    header h1{font-size:18px;margin:0;letter-spacing:0.6px;}
    header p{margin:0;font-size:12px;opacity:0.95;}

    /* ========== Category scroller ========= */
    .categories{
      display:flex; gap:10px; overflow-x:auto; padding:12px;
      background: linear-gradient(180deg,var(--green-soft),transparent);
      -webkit-overflow-scrolling:touch;
    }
    .cat-btn{
      flex:0 0 auto;
      background:var(--glass);
      border:1px solid rgba(47,107,52,0.08);
      padding:10px 14px;
      border-radius:14px;
      font-weight:600;
      color:var(--green-dark);
      cursor:pointer;
      box-shadow: 0 6px 14px rgba(47,107,52,0.06);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .cat-btn:active{ transform: translateY(2px); }
    .cat-btn.active{ background: linear-gradient(90deg,#ffffff,#f3fff3); border:1px solid var(--green-mid); box-shadow: 0 8px 20px rgba(79,182,79,0.12); }

    /* ========== Menu cards ========= */
    main{padding:14px;}
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
      gap:12px;
    }
    .card{
      background: linear-gradient(180deg,#ffffff,#fbfff9);
      border-radius:14px;
      padding:12px;
      box-shadow: var(--card-shadow);
      display:flex; flex-direction:column; gap:8px;
      cursor:pointer;
      border: 1px solid rgba(47,107,52,0.04);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .card:active{ transform: translateY(3px); }
    .card h3{margin:0;font-size:15px;color:var(--green-dark);}
    .card p{margin:0;font-size:13px;color:#476b50; opacity:0.95;}
    .price{
      margin-top:auto;
      display:flex;justify-content:space-between;align-items:center;
      gap:8px;
    }
    .price .value{
      background: linear-gradient(90deg,var(--green-mid),#2f8f35);
      color:#fff;padding:6px 10px;border-radius:10px;font-weight:700;font-size:14px;
      box-shadow: 0 6px 12px rgba(47,107,52,0.12);
    }

    /* ========== Modal (selection) ========= */
    .overlay{
      position:fixed; inset:0; background:rgba(0,0,0,0.4); display:none; align-items:flex-end; justify-content:center;
      z-index:80; -webkit-backdrop-filter: blur(4px);
    }
    .sheet{
      width:100%; max-width:520px; background:#fff; border-top-left-radius:18px; border-top-right-radius:18px;
      padding:14px 16px 30px; box-shadow: 0 -8px 30px rgba(0,0,0,0.18);
    }
    .sheet header{display:flex;gap:10px;align-items:center;}
    .sheet h2{margin:0;font-size:18px;color:var(--green-dark);}
    .close-x{margin-left:auto;background:#f6f6f6;border-radius:10px;padding:6px;cursor:pointer;}
    .choice-row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0;}
    .chip{
      padding:8px 10px;border-radius:12px;background:#f8fff8;border:1px solid #e6f3e6; cursor:pointer;font-weight:600;color:var(--green-dark);
    }
    .chip.selected{background:linear-gradient(90deg,var(--green-mid),#3fa84a); color:#fff; box-shadow:0 8px 18px rgba(79,182,79,0.14);}
    .label{font-size:13px;color:#2f4f36;margin:10px 0 6px;font-weight:600;}

    /* checkboxes style */
    .option {display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;background:#fbfff9;border:1px solid #eef7ee;margin:6px 0;}
    .option input[type="checkbox"], .option input[type="radio"]{width:18px;height:18px;accent-color:var(--green-mid);}

    .qty{
      display:flex;gap:8px;align-items:center;
    }
    .qty button{padding:6px 10px;border-radius:8px;border:none;background:var(--green-mid);color:#fff;font-weight:700;cursor:pointer;}
    .qty input{width:64px;padding:8px;border-radius:8px;border:1px solid #e6f3e6;text-align:center;}

    .sheet .bottom-row{display:flex;gap:10px;align-items:center;margin-top:12px;}
    .sheet .total{margin-left:auto;font-weight:800;color:var(--green-dark);}

    /* ========== Cart bar (footer) ========= */
    .cart-bar{
      position:fixed; left:12px; right:12px; bottom:14px; z-index:70;
      display:flex; gap:10px; align-items:center;
    }
    .cart-preview{
      flex:1;background:linear-gradient(180deg,#ffffff,#f8fff8);padding:12px;border-radius:12px;box-shadow:var(--card-shadow);
      display:flex;align-items:center;gap:8px;border:1px solid rgba(47,107,52,0.06);
    }
    .cart-preview .count{background:var(--accent); color:#fff;padding:6px 10px;border-radius:10px;font-weight:700;}
    .cart-preview .summary{font-size:14px;color:#234b2b;font-weight:700;}

    .cart-actions button{ padding:12px 14px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--green-dark),var(--green-mid)); color:#fff;font-weight:800; cursor:pointer; box-shadow:0 10px 24px rgba(47,107,52,0.12);}
    .cart-actions button.secondary{ background:#fff;border:1px solid #e6f3e6;color:var(--green-dark);font-weight:700;box-shadow:none; }

    /* ========== Order summary modal ========= */
    .dialog{
      position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none;align-items:center;justify-content:center; z-index:100;
    }
    .dialog .card{
      width:92%; max-width:480px; padding:16px; border-radius:14px;
    }
    .order-list{max-height:300px; overflow:auto; margin:8px 0; padding:6px; border-radius:8px; background:#fbfff8;}

    /* responsive tweaks */
    @media(min-width:510px){
      header h1{font-size:20px;}
      .sheet{border-radius:12px;}
      .cart-bar{max-width:520px;left:auto;right:auto;bottom:20px; margin:0 auto;}
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="logo"><img src="logo.png" alt="‡∏û‡∏¢"></div>
    <div>
      <h1>‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡∏ä‡∏≤‡∏û‡∏∞‡∏¢‡∏≠‡∏°</h1>
      <p style="margin-top:4px;font-size:12px;opacity:0.95">...</p>
    </div>
  </header>

  <!-- Categories -->
  <div class="categories" id="cats">
    <button class="cat-btn active" data-cat="‡∏ä‡∏≤" onclick="selectCategory(event)">‡∏ä‡∏≤</button>
    <button class="cat-btn" data-cat="‡∏ô‡∏°" onclick="selectCategory(event)">‡∏ô‡∏° / ‡πÇ‡∏Å‡πÇ‡∏Å‡πâ / ‡∏Ñ‡∏≤‡∏£‡∏≤‡πÄ‡∏°‡∏•</button>
    <button class="cat-btn" data-cat="‡∏Å‡∏≤‡πÅ‡∏ü" onclick="selectCategory(event)">‡∏Å‡∏≤‡πÅ‡∏ü</button>
    <button class="cat-btn" data-cat="‡πÇ‡∏ã‡∏î‡∏≤" onclick="selectCategory(event)">‡πÇ‡∏ã‡∏î‡∏≤</button>
  </div>

  <!-- Menu -->
  <main>
    <div class="grid" id="menuGrid"></div>
  </main>

  <!-- Selection sheet (bottom modal) -->
  <div class="overlay" id="overlay">
    <div class="sheet" role="dialog" aria-modal="true" id="sheet">
      <header>
        <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(180deg,#fff,#f6fff6);display:flex;align-items:center;justify-content:center;color:var(--green-dark);font-weight:700">‡πÅ‡∏Å‡πâ‡∏ß</div>
        <div>
          <h2 id="sheetTitle">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</h2>
          <div style="font-size:13px;color:#49664a" id="sheetBase">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: 0 ‡∏ö‡∏≤‡∏ó</div>
        </div>
        <div class="close-x" onclick="closeSheet()">‚úï</div>
      </header>

      <!-- Temp -->
      <div class="label">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
      <div class="choice-row" id="tempChips">
        <div class="chip selected" data-plus="10" data-val="‡∏õ‡∏±‡πà‡∏ô" onclick="chooseChip(this,'temp')">‡∏õ‡∏±‡πà‡∏ô +10</div>
      </div>

      <!-- Cream -->
      <div class="label">‡∏Ñ‡∏£‡∏µ‡∏°‡∏ä‡∏µ‡∏ó</div>
      <div class="choice-row">
        <label class="option"><input type="checkbox" id="optCream" data-plus="10" onchange="recalc()"> ‡πÉ‡∏™‡πà‡∏Ñ‡∏£‡∏µ‡∏°‡∏ä‡∏µ‡∏ó (+10)</label>
      </div>

      <!-- Toppings -->
      <div class="label">‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</div>
      <div class="choice-row">
        <label class="option"><input type="checkbox" class="top" value="‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å" data-plus="5" onchange="recalc()"> ‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å (+5)</label>
        <label class="option"><input type="checkbox" class="top" value="‡∏ö‡∏∏‡∏Å" data-plus="5" onchange="recalc()"> ‡∏ö‡∏∏‡∏Å (+5)</label>
      </div>

      <div class="label">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
        <textarea id="noteInput"
        style="width:100%; padding:10px; border-radius:10px; border:1px solid #d8e8d8; font-family:inherit;"></textarea>

      <!-- Quantity & total -->
      <div class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏Å‡πâ‡∏ß</div>
      <div style="display:flex;gap:10px;align-items:center;margin-top:6px;">
        <div class="qty">
          <button onclick="changeQty(-1)">‚àí</button>
          <input type="number" id="qtyInput" value="1" min="1" onchange="recalc()" />
          <button onclick="changeQty(1)">+</button>
        </div>
        <div class="total" id="sheetTotal">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: 0 ‡∏ö‡∏≤‡∏ó</div>
      </div>

      <div class="bottom-row">
        <button class="secondary" onclick="closeSheet()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <div style="flex:1"></div>
        <button onclick="addToCart()">‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ¬∑ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      </div>
    </div>
  </div>

  <!-- Cart preview (fixed footer) -->
  <div class="cart-bar" id="cartBar" style="display:none;">
    <div class="cart-preview" onclick="openCart()">
      <div class="count" id="cartCount">0</div>
      <div class="summary">
        <div id="cartShort">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
        <div style="font-size:12px;color:#3d6b45" id="cartShortTotal">0 ‡∏ö‡∏≤‡∏ó</div>
      </div>
    </div>
    <div class="cart-actions">
      <button onclick="openCart()">‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
    </div>
  </div>

  <!-- Order dialog -->
  <div class="dialog" id="orderDialog">
    <div class="card">
      <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
      <div class="order-list" id="orderList"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;">
        <div style="font-weight:800;color:var(--green-dark)">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="finalTotal">0</span> ‡∏ö‡∏≤‡∏ó</div>
        <div style="display:flex;gap:8px;">
          <button class="secondary" onclick="closeOrder()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button onclick="sendOrder()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô & ‡∏™‡πà‡∏á</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ========== Data model ========== */
const MENU = {
  "‡∏ä‡∏≤": [
    {name:"‡∏ä‡∏≤‡∏ô‡∏°", price:30},
    {name:"‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", price:30},
    {name:"‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢", price:30},
    {name:"‡∏ä‡∏≤‡∏°‡∏∞‡∏ô‡∏≤‡∏ß", price:30}
  ],
  "‡∏ô‡∏°": [
    {name:"‡∏ô‡∏°‡∏™‡∏î", price:30},
    {name:"‡πÇ‡∏Å‡πÇ‡∏Å‡πâ", price:35},
    {name:"‡∏Ñ‡∏≤‡∏£‡∏≤‡πÄ‡∏°‡∏•‡∏ô‡∏°", price:30}
  ],
  "‡∏Å‡∏≤‡πÅ‡∏ü": [
    {name:"‡∏Å‡∏≤‡πÅ‡∏ü‡πÄ‡∏¢‡πá‡∏ô", price:30},
    {name:"‡∏•‡∏≤‡πÄ‡∏ï‡πâ", price:30},
    {name:"‡∏Ñ‡∏≤‡∏õ‡∏π‡∏ä‡∏¥‡πÇ‡∏ô‡πà", price:30}
  ],
  "‡πÇ‡∏ã‡∏î‡∏≤": [
    {name:"‡∏ö‡∏•‡∏π‡∏Æ‡∏≤‡∏ß‡∏≤‡∏¢‡πÇ‡∏ã‡∏î‡∏≤", price:30},
    {name:"‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà‡πÇ‡∏ã‡∏î‡∏≤", price:30},
    {name:"‡πÄ‡∏•‡∏°‡∏≠‡∏ô‡πÇ‡∏ã‡∏î‡∏≤", price:30}
  ]
};

let currentCategory = '‡∏ä‡∏≤';
let selected = null;
let cart = [];

/* ========== Init ========= */
function init(){
  renderMenu(currentCategory);
}

function selectCategory(e){
  const btn = e.currentTarget;
  document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  currentCategory = btn.dataset.cat;
  renderMenu(currentCategory);
}

function renderMenu(cat){
  const grid = document.getElementById('menuGrid');
  grid.innerHTML = '';
  MENU[cat].forEach(item=>{
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <h3>${item.name}</h3>
      <p>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°</p>
      <div class="price"><div style="font-size:13px;color:#3a6b3f">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div><div class="value">${item.price} ‡∏ø</div></div>
    `;
    el.onclick = ()=> openSheet(item);
    grid.appendChild(el);
  });
}

/* ========== Sheet ========= */
function openSheet(item){
  selected = {name:item.name, base:item.price};
  document.getElementById('sheetTitle').innerText = item.name;
  document.getElementById('sheetBase').innerText = `‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ${item.price} ‡∏ö‡∏≤‡∏ó`;
  document.querySelectorAll('#tempChips .chip').forEach((c,i)=> c.classList.toggle('selected', i===0));
  document.getElementById('optCream').checked = false;
  document.querySelectorAll('.top').forEach(t=> t.checked=false);
  document.getElementById('qtyInput').value = 1;
  document.getElementById('noteInput').value = "";

  recalc();
  document.getElementById('overlay').style.display = 'flex';
}

function closeSheet(){
  document.getElementById('overlay').style.display = 'none';
}

function chooseChip(el){
  document.querySelectorAll('#tempChips .chip').forEach(c=> c.classList.remove('selected'));
  el.classList.add('selected');
  recalc();
}

function getSelectedTemp(){
  const el = document.querySelector('#tempChips .chip.selected');
  return {val: el.dataset.val, plus: Number(el.dataset.plus || 0)};
}

function recalc(){
  if(!selected) return;
  const base = selected.base;
  const temp = getSelectedTemp();
  const cream = document.getElementById('optCream').checked ? Number(document.getElementById('optCream').dataset.plus || 10) : 0;
  const toppings = Array.from(document.querySelectorAll('.top:checked')).reduce((s,t)=> s + Number(t.dataset.plus || 5), 0);
  const qty = Math.max(1, Number(document.getElementById('qtyInput').value || 1));
  const total = (base + temp.plus + cream + toppings) * qty;
  document.getElementById('sheetTotal').innerText = `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: ${total} ‡∏ö‡∏≤‡∏ó`;
  return total;
}

function changeQty(delta){
  const inp = document.getElementById('qtyInput');
  let v = Math.max(1, Number(inp.value || 1) + delta);
  inp.value = v;
  recalc();
}

/* ========== Cart ========= */
function addToCart(){
  if(!selected) return;
  const temp = getSelectedTemp();
  const cream = document.getElementById('optCream').checked ? '‡πÉ‡∏™‡πà‡∏Ñ‡∏£‡∏µ‡∏°‡∏ä‡∏µ‡∏ó' : '‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏Ñ‡∏£‡∏µ‡∏°‡∏ä‡∏µ‡∏ó';
  const toppings = Array.from(document.querySelectorAll('.top:checked')).map(t=> t.value);
  const qty = Math.max(1, Number(document.getElementById('qtyInput').value || 1));
  const total = recalc();
  const note = document.getElementById('noteInput').value || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏";

  if (selected.index !== undefined) {
  // ‡πÅ‡∏Å‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°
  cart[selected.index] = {
    name: selected.name,
    base: selected.base,
    temp: temp.val,
    cream,
    toppings,
    qty,
    note,
    total
  };
  delete selected.index;
} else {
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
  cart.push({
    name: selected.name,
    base: selected.base,
    temp: temp.val,
    cream,
    toppings,
    qty,
    note,
    total
  });
}
  closeSheet();
  updateCartBar();
  toast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚úîÔ∏è');
}

function updateCartBar(){
  const bar = document.getElementById('cartBar');
  if(cart.length === 0){ bar.style.display='none'; return; }
  bar.style.display = 'flex';
  document.getElementById('cartCount').innerText = cart.length;
  document.getElementById('cartShort').innerText = cart.map(c => `${c.name} x${c.qty}`).join(' ¬∑ ');
  const sum = cart.reduce((s,c)=> s + c.total,0);
  document.getElementById('cartShortTotal').innerText = `${sum} ‡∏ö‡∏≤‡∏ó`;
}

function openCart(){
  const dlg = document.getElementById('orderDialog');
  const list = document.getElementById('orderList');
  list.innerHTML = '';
  if(cart.length === 0){
    list.innerHTML = '<div style="padding:12px;color:#6b6b6b">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</div>';
  } else {
    cart.forEach((c,index)=>{
      const el = document.createElement('div');
      el.style.padding='8px';
      el.style.borderBottom='1px dashed #e6f3e6';
      el.innerHTML = `
  <div style="font-weight:700">
    ${c.name} x${c.qty}
    <span style="float:right;color:#2f6b34">${c.total} ‡∏ø</span>
  </div>
  <div style="font-size:13px;color:#47674f">
    ${c.temp} ¬∑ ${c.cream} ¬∑ ${c.toppings.length ? c.toppings.join(', ') : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á'}
    <br>üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${c.note}
  </div>

  <div style="margin-top:6px; display:flex; gap:6px; justify-content:flex-end;">
  <button onclick="editItem(${index})"
    style="padding:4px 8px; font-size:12px; border-radius:6px; border:1px solid #cce8cc; background:#f8fff8;">
    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  </button>
  <button onclick="deleteItem(${index})"
    style="padding:4px 8px; font-size:12px; border-radius:6px; border:1px solid #ffbbbb; background:#ffecec; color:#a80000;">
    ‡∏•‡∏ö
  </button>
</div>
`;
      list.appendChild(el);
    });
  }
  document.getElementById('finalTotal').innerText = cart.reduce((s,c)=> s + c.total,0);
  dlg.style.display='flex';
}

function closeOrder(){
  document.getElementById('orderDialog').style.display='none';
}

/* ========== Message Queue System ========== */
const messageQueue = [];
let sending = false;

async function queueMessage(message){
  messageQueue.push(message);
  if(!sending) processQueue();
}

async function processQueue(){
  if(sending) return;
  sending = true;
  while(messageQueue.length>0){
    const msg = messageQueue.shift();
    try {
      await sendToLine(msg);
    } catch(err){
      console.error("‚ùå Error sending:", err);
    }
    await new Promise(r=>setTimeout(r,500));
  }
  sending = false;
}

async function sendToLine(message){
  const res = await fetch("/api/send-line", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({message})
  });
  if(!res.ok) console.error("‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", await res.text());
  else console.log("‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", message);
}

/* ========== ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ========== */
async function sendOrder(){
  const payload = {
    items: cart.map(c=>({
  name:c.name,
  qty:c.qty,
  temp:c.temp,
  cream:c.cream,
  toppings:c.toppings,
  note:c.note,     // ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ!
  price:c.total
})),
    total: cart.reduce((s,c)=> s+c.total,0),
    created: new Date().toLocaleString('th-TH')
  };

  // üßã ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ñ‡∏¥‡∏ß‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Äî server ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£)
  const message =
    payload.items.map(i =>
  `‚Ä¢ ${i.name} (${i.temp}) x${i.qty}
  ${i.cream}${i.toppings.length ? '¬∑ ' + i.toppings.join(', ') : ''}
  üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${i.note}
  üíµ ${i.price} ‡∏ö‡∏≤‡∏ó`
    ).join('\n\n') +
    `\n\nüí∞ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${payload.total} ‡∏ö‡∏≤‡∏ó\nüïì ${payload.created}`;

  await queueMessage(message);

  closeOrder();
  cart = [];
  updateCartBar();
  showSummary(payload);
}

/* ========== ‡∏™‡∏£‡∏∏‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ========== */
function showSummary(payload){
  const box = document.createElement('div');
  box.className = 'card';
  box.style.position='fixed'; box.style.left='6%'; box.style.right='6%'; box.style.top='14%';
  box.style.zIndex='120';
  box.innerHTML = `<h3>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ üéâ</h3>
    <div style="margin-top:8px;font-weight:700">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${payload.total} ‡∏ö‡∏≤‡∏ó</div>
    <div style="font-size:13px;color:#3a6b3f;margin-top:8px">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ${payload.created}</div>
    <div style="margin-top:12px"><button onclick="this.parentElement.parentElement.remove()">‡∏õ‡∏¥‡∏î</button></div>`;
  document.body.appendChild(box);
  setTimeout(()=>{ if(box.parentElement) box.remove(); },6000);
}




function editItem(index){
  closeOrder();
  const item = cart[index];
  selected = { name: item.name, base: item.base, index };

  // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π
  document.getElementById('sheetTitle').innerText = item.name;
  document.getElementById('sheetBase').innerText = `‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ${item.base} ‡∏ö‡∏≤‡∏ó`;

  // temp
  document.querySelectorAll('#tempChips .chip').forEach(c=>{
    c.classList.toggle('selected', c.dataset.val === item.temp);
  });

  // cream
  document.getElementById('optCream').checked = item.cream === '‡πÉ‡∏™‡πà‡∏Ñ‡∏£‡∏µ‡∏°‡∏ä‡∏µ‡∏ó';

  // toppings
  document.querySelectorAll('.top').forEach(t=>{
    t.checked = item.toppings.includes(t.value);
  });

  // qty
  document.getElementById('qtyInput').value = item.qty;

  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  document.getElementById('noteInput').value = item.note;

  recalc();
  document.getElementById('overlay').style.display = 'flex';
}

function deleteItem(index){
  cart.splice(index, 1);   // ‚úÖ ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  updateCartBar();         // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ñ‡∏ö‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
  openCart();              // ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠ refresh ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
  toast("‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚ùå");
}


/* ========== Toast ========= */
function toast(txt){
  const t=document.createElement('div');
  t.style.position='fixed';t.style.bottom='90px';t.style.left='50%';t.style.transform='translateX(-50%)';
  t.style.background='rgba(0,0,0,0.7)';t.style.color='#fff';t.style.padding='10px 14px';t.style.borderRadius='12px';
  t.style.fontWeight='700';t.style.zIndex=200;t.innerText=txt;
  document.body.appendChild(t);setTimeout(()=>t.remove(),1800);
}

window.addEventListener('load',init);
</script>
